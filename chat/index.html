<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Messenger</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for UI elements -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts for a modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .chat-item.active {
            background-color: #e0f2fe;
        }
        /* Simple transition for emoji picker */
        #emoji-picker {
            transition: opacity 0.2s, transform 0.2s;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main App Layout -->
    <div class="w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl flex h-[90vh] overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-1/3 bg-gray-50 border-r border-gray-200 flex flex-col">
            <!-- Sidebar Header with Search -->
            <header class="p-4 border-b border-gray-200">
                <h1 class="text-xl font-bold text-gray-800 mb-4">Chats</h1>
                <div class="relative">
                    <input type="search" id="search-input" placeholder="Search messages..." class="w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                </div>
            </header>

            <!-- Chat List -->
            <nav class="flex-1 overflow-y-auto custom-scrollbar p-2">
                <!-- Public Chats Section -->
                <div>
                    <h2 class="px-2 py-1 text-xs font-semibold text-gray-500 uppercase">Public</h2>
                    <ul>
                        <li>
                            <a href="#" id="public-chat-btn" class="chat-item flex items-center p-3 rounded-lg hover:bg-gray-100 transition-colors duration-200 active">
                                <div class="w-10 h-10 bg-blue-500 text-white flex items-center justify-center rounded-full mr-3">#</div>
                                <span class="font-semibold text-gray-700">general</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- Direct Messages Section -->
                <div class="mt-4">
                    <h2 class="px-2 py-1 text-xs font-semibold text-gray-500 uppercase">Direct Messages</h2>
                    <ul id="dm-list">
                        <p class="px-2 py-2 text-sm text-gray-400">No direct messages.</p>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Chat Area -->
        <section class="w-2/3 flex flex-col bg-white">
            <!-- Header -->
            <header class="bg-white text-gray-800 p-4 border-b border-gray-200 flex items-center justify-between shadow-sm">
                <div class="flex items-center">
                    <div class="relative">
                        <img src="https://placehold.co/40x40/ffffff/3B82F6?text=G" alt="Group Avatar" class="w-10 h-10 rounded-full">
                        <span class="absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-400 border-2 border-white"></span>
                    </div>
                    <div class="ml-4">
                        <h2 id="chat-title" class="text-lg font-semibold">#general</h2>
                        <p id="chat-status" class="text-xs text-gray-500">Public Channel</p>
                    </div>
                </div>
            </header>

            <!-- Chat Messages Area -->
            <main id="chat-messages" class="flex-1 p-6 overflow-y-auto custom-scrollbar space-y-4"></main>

            <!-- Footer with Input -->
            <footer class="bg-gray-50 p-4 border-t border-gray-200 relative">
                 <!-- Emoji Picker -->
                <div id="emoji-picker" class="hidden absolute bottom-full mb-2 bg-white border border-gray-200 rounded-lg shadow-lg p-2 grid grid-cols-6 gap-2">
                    <!-- Emojis will be populated by JS -->
                </div>
                <div class="flex items-center bg-white border border-gray-200 rounded-full p-2 shadow-sm">
                    <button id="emoji-btn" class="text-gray-500 hover:text-blue-600 p-2">
                        <i data-lucide="smile" class="w-6 h-6"></i>
                    </button>
                    <input type="text" id="message-input" placeholder="Type a message..." class="flex-1 bg-transparent px-4 py-2 text-gray-700 focus:outline-none">
                    <button id="send-btn" class="bg-blue-600 text-white rounded-full p-2 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200">
                         <i data-lucide="send" class="w-6 h-6"></i>
                    </button>
                </div>
            </footer>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatContainer = document.getElementById('chat-messages');
            const searchInput = document.getElementById('search-input');
            const chatTitle = document.getElementById('chat-title');
            const chatStatus = document.getElementById('chat-status');
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const emojiBtn = document.getElementById('emoji-btn');
            const emojiPicker = document.getElementById('emoji-picker');

            let allMessages = [];
            const apiUrl = 'https://api.github.com/repos/Bob-2015/bob-2015.github.io/contents/chat/chat.txt?ref=main';

            const renderMessages = (messages) => {
                chatContainer.innerHTML = '';
                if (!messages || messages.length === 0) {
                    chatContainer.innerHTML = '<p class="text-center text-gray-500">No messages found.</p>';
                    return;
                }
                messages.forEach(line => addMessageBubble(line, false)); // Add existing messages as "received"
                chatContainer.scrollTop = chatContainer.scrollHeight;
            };

            const addMessageBubble = (text, isSent) => {
                if (text.trim() === '') return;
                const messageWrapper = document.createElement('div');
                const messageBubble = document.createElement('div');

                if (isSent) {
                    messageWrapper.className = 'flex justify-end';
                    messageBubble.className = 'bg-blue-600 text-white rounded-2xl rounded-br-lg p-3 max-w-xs md:max-w-md shadow animate-fade-in';
                } else {
                    messageWrapper.className = 'flex justify-start';
                    messageBubble.className = 'bg-gray-200 text-gray-800 rounded-2xl rounded-bl-lg p-3 max-w-xs md:max-w-md shadow animate-fade-in';
                }
                messageBubble.textContent = text;
                messageWrapper.appendChild(messageBubble);
                chatContainer.appendChild(messageWrapper);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            };

            const fetchMessages = () => {
                chatContainer.innerHTML = `<div class="flex justify-center items-center h-full"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div></div>`;
                fetch(apiUrl)
                    .then(response => response.ok ? response.json() : Promise.reject(response.statusText))
                    .then(data => {
                        // The user is correct, GitHub API puts base64 content in the 'content' property.
                        if (data && data.content) {
                            const decodedContent = atob(data.content);
                            allMessages = decodedContent.split('\n').filter(line => line.trim() !== '');
                            renderMessages(allMessages);
                        } else {
                            throw new Error("API response did not contain 'content' field.");
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching chat data:', error);
                        chatContainer.innerHTML = `<div class="text-center text-red-500 p-4"><strong>Failed to load messages.</strong><p>${error.message}</p></div>`;
                    });
            };
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredMessages = allMessages.filter(msg => msg.toLowerCase().includes(searchTerm));
                renderMessages(filteredMessages);
            });

            const sendMessage = () => {
                const text = messageInput.value;
                if (text.trim() !== '') {
                    addMessageBubble(text, true); // Add new message as "sent"
                    messageInput.value = ''; // Clear input
                    messageInput.focus();
                    // NOTE: This message is only added to your screen. It is not saved to the server.
                }
            };

            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // --- Emoji Picker Logic ---
            const emojis = ['ðŸ˜€', 'ðŸ˜‚', 'ðŸ˜', 'ðŸ‘', 'â¤ï¸', 'ðŸ¤”', 'ðŸŽ‰', 'ðŸ”¥', 'ðŸš€', 'ðŸ’¯', 'ðŸ™', 'ðŸ˜­'];
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.className = 'p-1 text-2xl rounded-lg hover:bg-gray-200';
                button.textContent = emoji;
                button.onclick = () => {
                    messageInput.value += emoji;
                    emojiPicker.classList.add('hidden');
                    messageInput.focus();
                };
                emojiPicker.appendChild(button);
            });

            emojiBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                emojiPicker.classList.toggle('hidden');
            });
            
            // Hide emoji picker if clicking outside
            document.addEventListener('click', (e) => {
                if (!emojiPicker.contains(e.target) && !emojiBtn.contains(e.target)) {
                    emojiPicker.classList.add('hidden');
                }
            });


            fetchMessages();
            lucide.createIcons();
        });
    </script>
</body>
</html>

